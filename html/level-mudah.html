<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Level Mudah - KaliKu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <meta name="theme-color" content="#fff8c2" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="../asset/image/kaliku.png" type="image/png" />
    <style>
        body {
            background-color: #fff8c2;
            font-family: "Poppins", sans-serif;
            text-align: center;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 30px;
            position: relative;
        }

        .container {
            max-width: 600px;
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .icon-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #6e3012;
        }

        .icon-btn:hover {
            color: #ff9800;
        }

        h2 {
            font-weight: 700;
            color: #6e3012;
            margin-bottom: 20px;
        }

        #question {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .dropzone {
            margin: 20px auto;
            padding: 15px;
            border: 2px dashed #aaa;
            border-radius: 10px;
            background-color: #f9f9f9;
            width: 180px;
            min-height: 40px;
            font-size: 16px;
            line-height: 40px;
        }

        .choices {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-top: 20px;
            gap: 12px;
        }

        .choice {
            flex: 1 1 45%;
            min-width: 100px;
            padding: 12px;
            background: #8b4513;
            color: white;
            border-radius: 8px;
            cursor: grab;
            font-size: 18px;
            text-align: center;
            box-shadow: 0 3px 0 rgba(0, 0, 0, 0.2);
            transition: transform 0.1s;
        }

        .choice:active {
            transform: scale(0.95);
        }

        .feedback,
        .hint,
        .lives {
            font-size: 18px;
            margin-top: 15px;
        }

        .lives {
            color: red;
        }

        .timer {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-top: 10px;
        }

        .bg-gradient-setting {
            background: linear-gradient(90deg, #6e3012 60%, #ff9800 100%);
            border-bottom: 3px solid #ffecb3;
        }

        .modal-content {
            border-radius: 1.5rem !important;
        }

        .modal-header .material-icons {
            font-size: 2.2rem;
        }

        .modal-header {
            border-top-left-radius: 1.5rem !important;
            border-top-right-radius: 1.5rem !important;
        }

        .modal-footer {
            border-bottom-left-radius: 1.5rem !important;
            border-bottom-right-radius: 1.5rem !important;
            border-top: none;
        }

        .setting-btn {
            border: none;
            background: #fffbe7;
            color: #6e3012;
            font-size: 1.08rem;
            border-radius: 2rem;
            padding: 0.85rem 1.3rem;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            font-weight: 600;
            box-shadow: 0 1px 5px rgba(150, 100, 40, 0.08);
            margin-bottom: 0.1rem;
            outline: none !important;
            text-decoration: none !important;
        }

        .setting-btn:hover,
        .setting-btn:focus {
            background: #ffe0b2;
            color: #d17c27;
            box-shadow: 0 4px 12px rgba(200, 130, 40, 0.15);
            text-decoration: none !important;
        }

        .setting-btn .material-icons {
            font-size: 1.7rem;
            vertical-align: middle;
        }

        .status-badge {
            min-width: 52px;
            font-size: 1rem;
            font-weight: bold;
            background: #ffd600;
            color: #795548;
            border: 2px solid #ffe082;
            box-shadow: 0 0 4px #ffe082;
            letter-spacing: 1px;
        }

        #musikStatus.off,
        #soundStatus.off {
            background: #bdbdbd !important;
            color: #fff !important;
            border-color: #e0e0e0 !important;
            box-shadow: none !important;
        }

        @media (max-width: 576px) {

            .modal-content,
            .modal-header,
            .modal-footer {
                border-radius: 1rem !important;
            }
        }
    </style>
</head>

<body>
    <!-- Pengaturan kanan atas -->
    <div class="position-absolute top-0 end-0 p-3">
        <button class="icon-btn" data-bs-toggle="modal" data-bs-target="#pengaturanModal">
            <span class="material-icons">settings</span>
        </button>
    </div>
    <!-- Benar/Salah kiri atas -->
    <div class="position-absolute top-0 start-0 p-3 text-start">
        <span class="material-icons" style="color:#37b24d;vertical-align:-4px;font-size:21px;">check_circle</span>
        <span id="jumlahBenar" style="font-weight:600;margin-right:10px;">0</span>
        <span class="material-icons" style="color:#c92a2a;vertical-align:-4px;font-size:21px;">cancel</span>
        <span id="jumlahSalah" style="font-weight:600;">0</span>
    </div>
    <!-- Game Area -->
    <div class="game-wrapper">
        <h2>Level Mudah</h2>
        <div id="questionNumber"></div>
        <div id="question">Soal akan muncul di sini</div>
        <div class="timer" id="timer">
            <span class="material-icons" style="vertical-align:middle;font-size:20px;">timer</span>
            Waktu: 10 detik
        </div>
        <div class="dropzone" id="dropzone" ondrop="drop(event)" ondragover="event.preventDefault()">
            Tarik jawaban ke sini
        </div>
        <button class="btn btn-warning mt-3 d-flex align-items-center gap-2 justify-content-center mx-auto"
            onclick="bukaModalBantuan()">
            <span class="material-icons">help_outline</span>
            <span>Bantuan</span>
            <span class="bantuan-limit ms-2" id="sisaBantuan">(3x tersisa)</span>
        </button>
        <div class="choices" id="choices"></div>
        <div class="hint" id="hint"></div>
        <div class="feedback" id="feedback"></div>
        <div class="lives" id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <!-- MODAL SETTING -->
    <div class="modal fade" id="pengaturanModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header bg-gradient-setting text-white d-flex align-items-center gap-2">
                    <span class="material-icons fs-1 me-2">settings</span>
                    <h5 class="modal-title flex-grow-1 fw-bold">Pengaturan</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body py-4 d-flex flex-column gap-3">
                    <button class="setting-btn d-flex align-items-center justify-content-between"
                        onclick="toggleMusik()">
                        <div><span class="material-icons me-2">music_note</span>Musik</div>
                        <span id="musikStatus" class="badge rounded-pill status-badge ms-2">ON</span>
                    </button>
                    <button class="setting-btn d-flex align-items-center justify-content-between"
                        onclick="toggleSound()">
                        <div><span class="material-icons me-2">volume_up</span>Sound</div>
                        <span id="soundStatus" class="badge rounded-pill status-badge ms-2">ON</span>
                    </button>
                    <hr />
                    <a href="halaman-utama.html" class="setting-btn d-flex align-items-center">
                        <span class="material-icons me-2">home</span> Beranda
                    </a>
                    <button class="setting-btn d-flex align-items-center" onclick="ulangiPermainan()">
                        <span class="material-icons me-2">restart_alt</span> Ulangi Permainan
                    </button>
                </div>
                <div class="modal-footer bg-light py-2">
                    <button
                        class="btn btn-secondary w-100 rounded-pill d-flex align-items-center justify-content-center gap-2"
                        data-bs-dismiss="modal" style="font-weight:600;">
                        <span class="material-icons">close</span> <span>Tutup</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL PEMBUKA -->
    <div class="modal fade" id="modalPembuka" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header bg-success text-white d-flex align-items-center">
                    <span class="material-icons fs-1 me-2">play_circle</span>
                    <h5 class="modal-title flex-grow-1 fw-bold">Level Mudah</h5>
                </div>
                <div class="modal-body text-start">
                    <p>Selamat datang di <strong>Level Mudah</strong>!</p>
                    <p>Jawab soal perkalian sebelum waktu habis. Jangan sampai kehabisan nyawa ya!</p>
                    <ul>
                        <li>‚è±Ô∏è Waktu: 10 detik per soal</li>
                        <li>‚úÖ Jawaban benar = lanjut soal berikutnya</li>
                        <li>‚ùå Salah atau waktu habis = kehilangan 1 nyawa</li>
                        <li>‚ù§Ô∏è Total nyawa: 3. Jika habis, permainan selesai</li>
                    </ul>
                    <div class="alert alert-warning d-flex align-items-center gap-2 py-2 mt-2 mb-2 fs-6">
                        <span class="material-icons" style="color:#ffa000;">flag</span>
                        <div>
                            Selesaikan <strong>20 soal dengan benar</strong> untuk membuka level berikutnya!
                        </div>
                    </div>
                    <p class="mb-2 fw-semibold">
                        Bantuan hanya boleh digunakan <strong>3 kali total</strong> selama permainan.<br />
                        Pilih tambah waktu <em>atau</em> cara hitung, maksimal 3x untuk semua soal.
                    </p>
                    <p class="fw-bold mb-0">Siap? Tekan <span class="material-icons align-middle">play_arrow</span>
                        untuk mulai!</p>
                </div>
                <div
                    class="modal-footer d-flex flex-column flex-md-row gap-2 justify-content-between bg-light rounded-bottom-4">
                    <a href="halaman-utama.html?showLevel=1"
                        class="btn btn-secondary w-100 w-md-auto rounded-pill d-flex align-items-center justify-content-center gap-2">
                        <span class="material-icons">close</span>
                        <span>Batal</span>
                    </a>
                    <button
                        class="btn btn-primary w-100 w-md-auto rounded-pill d-flex align-items-center justify-content-center gap-2"
                        onclick="mulaiPermainan()">
                        <span class="material-icons">play_arrow</span>
                        <span>Mulai</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL BANTUAN -->
    <div class="modal fade" id="modalBantuan" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header bg-gradient-info text-white d-flex align-items-center">
                    <span class="material-icons fs-1 me-2">help_outline</span>
                    <h5 class="modal-title flex-grow-1 fw-bold">Pilih Bantuan</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body d-grid gap-2">
                    <button
                        class="btn btn-outline-primary rounded-pill d-flex align-items-center justify-content-center gap-2"
                        onclick="bantuanWaktu()">
                        <span class="material-icons">add_alarm</span>
                        <span>Tambah Waktu 10 Detik</span>
                    </button>
                    <button
                        class="btn btn-outline-success rounded-pill d-flex align-items-center justify-content-center gap-2"
                        onclick="bantuanHitung()">
                        <span class="material-icons">menu_book</span>
                        <span>Tampilkan Cara Hitung</span>
                    </button>
                </div>
                <div class="modal-footer bg-light py-2">
                    <div class="w-100 text-center bantuan-limit mb-2">
                        Sisa bantuan: <span id="sisaBantuanModal">3</span> kali
                    </div>
                    <button
                        class="btn btn-secondary w-100 rounded-pill d-flex align-items-center justify-content-center gap-2"
                        data-bs-dismiss="modal">
                        <span class="material-icons">close</span>
                        <span>Tutup</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL SUKSES -->
    <div class="modal fade" id="modalSukses" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header bg-warning text-white d-flex align-items-center">
                    <span class="material-icons fs-1 me-2">celebration</span>
                    <h5 class="modal-title flex-grow-1 fw-bold">Selamat!</h5>
                </div>
                <div class="modal-body text-center">
                    <h2 class="fw-bold">Kamu berhasil menyelesaikan 20 soal dengan benar!</h2>
                    <p class="mt-3">Level berikutnya <strong>terbuka</strong> üéâ</p>
                </div>
                <div
                    class="modal-footer d-flex flex-column flex-md-row gap-2 justify-content-between bg-light rounded-bottom-4">
                    <a href="halaman-utama.html?showLevel=1"
                        class="btn btn-primary w-100 w-md-auto rounded-pill d-flex align-items-center justify-content-center gap-2">
                        <span class="material-icons">menu</span>
                        <span>Ke Menu Level</span>
                    </a>
                    <button
                        class="btn btn-secondary w-100 w-md-auto rounded-pill d-flex align-items-center justify-content-center gap-2"
                        onclick="ulangiPermainan()">
                        <span class="material-icons">restart_alt</span>
                        <span>Ulangi</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL GAME OVER -->
    <div class="modal fade" id="modalGameOver" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header bg-gradient-danger text-white d-flex align-items-center">
                    <span class="material-icons fs-1 me-2">close</span>
                    <h5 class="modal-title flex-grow-1 fw-bold">Game Over</h5>
                </div>
                <div class="modal-body text-center">
                    <h2 class="fw-bold" style="color:#c92a2a;">Yah, kesempatan habis!</h2>
                    <p>Benar: <b id="gameOverBenar">0</b> / 20 soal</p>
                    <p class="mb-2">Tetap semangat, coba lagi ya!</p>
                </div>
                <div
                    class="modal-footer flex-column flex-md-row gap-2 justify-content-between bg-light rounded-bottom-4">
                    <button
                        class="btn btn-success w-100 w-md-auto rounded-pill d-flex align-items-center justify-content-center gap-2"
                        onclick="ulangiPermainan()">
                        <span class="material-icons">restart_alt</span>
                        <span>Ulangi</span>
                    </button>
                    <a href="halaman-utama.html"
                        class="btn btn-secondary w-100 w-md-auto rounded-pill d-flex align-items-center justify-content-center gap-2">
                        <span class="material-icons">home</span>
                        <span>Kembali ke Beranda</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL KONFIRMASI KELUAR -->
    <div class="modal fade" id="modalKeluar" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header bg-gradient-danger text-white d-flex align-items-center">
                    <span class="material-icons fs-1 me-2">logout</span>
                    <h5 class="modal-title flex-grow-1 fw-bold">Konfirmasi Keluar</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Apakah kamu yakin ingin keluar dari permainan?</p>
                </div>
                <div class="modal-footer bg-light py-2">
                    <button
                        class="btn btn-secondary w-100 rounded-pill d-flex align-items-center justify-content-center gap-2"
                        data-bs-dismiss="modal">
                        <span class="material-icons">close</span>
                        <span>Batal</span>
                    </button>
                    <button
                        class="btn btn-danger w-100 rounded-pill d-flex align-items-center justify-content-center gap-2"
                        onclick="konfirmasiKeluar()">
                        <span class="material-icons">logout</span>
                        <span>Ya, Keluar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Soal tetap level mudah (perkalian 1 digit x 1 digit)
        const SOAL_TETAP = [
            [2, 3], [4, 5], [6, 7], [8, 2], [9, 3],
            [5, 5], [3, 7], [4, 9], [6, 4], [7, 8],
            [9, 6], [8, 3], [7, 7], [5, 9], [6, 8],
            [4, 6], [3, 8], [2, 9], [5, 7], [8, 4]
        ];
        const JUMLAH_BENAR_TARGET = SOAL_TETAP.length;

        let musikAktif = true;
        let soundAktif = true;
        let nyawa = 3, waktuSisa = 10, timerInterval;
        let indexSoal = 0, benarCount = 0, salahCount = 0, bantuanDigunakan = false;
        let bantuanTersisa = 3;
        let a, b, correctAnswer;
        let level = "mudah";

        function updateSkorBenarSalah() {
            document.getElementById("jumlahBenar").textContent = benarCount;
            document.getElementById("jumlahSalah").textContent = salahCount;
        }
        function updateBantuan() {
            document.getElementById("sisaBantuan").textContent = `(${bantuanTersisa}x tersisa)`;
        }
        function toggleSound() {
            soundAktif = !soundAktif;
            const status = document.getElementById("soundStatus");
            status.textContent = soundAktif ? "ON" : "OFF";
            status.classList.toggle('off', !soundAktif);
        }
        function toggleMusik() {
            musikAktif = !musikAktif;
            const musik = document.getElementById("musikLatar");
            if (musikAktif) musik.play(); else musik.pause();
            const status = document.getElementById("musikStatus");
            status.textContent = musikAktif ? "ON" : "OFF";
            status.classList.toggle('off', !musikAktif);
        }
        function mulaiTimer() {
            waktuSisa = 10;
            document.getElementById("timer").textContent = `‚è±Ô∏è Waktu: ${waktuSisa} detik`;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                waktuSisa--;
                document.getElementById("timer").textContent = `‚è±Ô∏è Waktu: ${waktuSisa} detik`;
                if (soundAktif) {
                    const tick = document.getElementById("tickSound");
                    tick.currentTime = 0;
                    tick.play();
                }
                if (waktuSisa <= 0) {
                    clearInterval(timerInterval);
                    waktuHabis();
                }
            }, 1000);
        }
        function stopTimer() { clearInterval(timerInterval); }
        function waktuHabis() {
            const penjelasan = penjelasanCaraHitung(a, b);
            document.getElementById("feedback").innerHTML = `‚åõ Waktu habis!<br>${penjelasan}`;
            nyawa--;
            salahCount++;
            updateLivesDisplay();
            updateSkorBenarSalah();
            const allChoices = document.querySelectorAll(".choice");
            allChoices.forEach(choice => choice.draggable = false);
            setTimeout(cekGameOverAtauLanjut, 3000);
        }
        function updateLivesDisplay() {
            document.getElementById("lives").textContent = "‚ù§Ô∏è".repeat(nyawa);
        }

        function penjelasanCaraHitung(a, b) {
            // Tampilkan perkalian sebagai penjumlahan berulang
            let faktor, pengali;
            // Supaya jumlah penjumlahan tidak terlalu panjang, pakai faktor yang kecil sebagai pengali
            if (b < a) {
                faktor = b;
                pengali = a;
            } else {
                faktor = a;
                pengali = b;
            }
            // Buat string penjumlahan berulang
            let penjumlahan = Array(faktor).fill(pengali).join(' + ');
            return `üí° Cara hitung: ${a} √ó ${b} = ${penjumlahan} = ...`;
        }
        function newQuestion() {
            if (nyawa <= 0 || indexSoal >= JUMLAH_BENAR_TARGET) return setTimeout(selesaikanPermainan, 200);
            [a, b] = SOAL_TETAP[indexSoal];
            correctAnswer = a * b;
            document.getElementById("question").textContent = `${a} √ó ${b} = ?`;
            document.getElementById("dropzone").textContent = "Tarik jawaban ke sini";
            document.getElementById("feedback").textContent = "";
            document.getElementById("hint").textContent = "";
            bantuanDigunakan = false;
            generateChoices();
            stopTimer();
            mulaiTimer();
            document.getElementById("questionNumber").innerHTML = `<span class="badge bg-success text-white rounded-pill px-3 py-2" style="font-size:1.1em">Soal: ${indexSoal + 1} / ${JUMLAH_BENAR_TARGET}</span>`;
            updateBantuan();
        }
        function generateChoices() {
            const container = document.getElementById("choices");
            container.innerHTML = "";
            let choices = new Set([correctAnswer]);
            while (choices.size < 4) {
                let delta = Math.floor(Math.random() * 7) + 2;
                let alt = Math.random() > 0.5 ? correctAnswer + delta : correctAnswer - delta;
                if (alt > 0) choices.add(alt);
            }
            Array.from(choices).sort(() => Math.random() - 0.5).forEach(val => {
                const el = document.createElement("div");
                el.textContent = val;
                el.className = "choice";
                el.draggable = true;
                el.ondragstart = e => e.dataTransfer.setData("text", el.textContent);
                container.appendChild(el);
            });
        }
        function drop(ev) {
            ev.preventDefault();
            stopTimer();
            const data = ev.dataTransfer.getData("text");
            const userAnswer = parseInt(data);
            const dropzone = document.getElementById("dropzone");
            dropzone.textContent = data;
            const allChoices = document.querySelectorAll(".choice");
            allChoices.forEach(choice => {
                if (choice.textContent === data) {
                    choice.style.backgroundColor = userAnswer === correctAnswer ? "#c8e6c9" : "#ffcdd2";
                    choice.style.color = userAnswer === correctAnswer ? "#2e7d32" : "#c62828";
                    choice.style.fontWeight = "bold";
                }
                choice.draggable = false;
            });
            if (userAnswer === correctAnswer) {
                benarCount++;
                indexSoal++;
                if (soundAktif) document.getElementById("benarSound").play();
                document.getElementById("feedback").textContent = "‚úÖ Benar!";
                updateSkorBenarSalah();
                setTimeout(cekGameOverAtauLanjut, 900);
            } else {
                nyawa--;
                salahCount++;
                updateSkorBenarSalah();
                if (soundAktif) document.getElementById("salahSound").play();
                const penjelasan = penjelasanCaraHitung(a, b);
                document.getElementById("feedback").innerHTML = `‚ùå Salah.<br>${penjelasan}`;
                setTimeout(cekGameOverAtauLanjut, 5000);
            }
            updateLivesDisplay();
        }
        function cekGameOverAtauLanjut() {
            if (nyawa <= 0 || indexSoal >= JUMLAH_BENAR_TARGET) {
                setTimeout(selesaikanPermainan, 220);
            } else {
                newQuestion();
            }
        }
        function selesaikanPermainan() {
            document.getElementById("musikLatar").pause();
            document.getElementById("musikLatar").currentTime = 0;
            if (benarCount >= JUMLAH_BENAR_TARGET && nyawa > 0) {
                const player = localStorage.getItem("game_username") || "Player";

                // Set flag unlock level sedang agar toast muncul di beranda
                localStorage.setItem('game_last_unlock', 'sedang');

                // Tandai progress level mudah selesai
                localStorage.setItem(`game_progress_${player}_mudah`, JSON.stringify({ finished: true }));

                if (soundAktif) document.getElementById("winSound").play();
                new bootstrap.Modal(document.getElementById("modalSukses")).show();
            } else {
                if (soundAktif) document.getElementById("selesaiSound").play();
                document.getElementById("gameOverBenar").textContent = benarCount;
                new bootstrap.Modal(document.getElementById("modalGameOver")).show();
            }
        }

        function ulangiPermainan() {
            nyawa = 5;
            benarCount = 0;
            salahCount = 0;
            indexSoal = 0;
            bantuanTersisa = 3;
            updateLivesDisplay();
            updateSkorBenarSalah();
            updateBantuan();
            stopTimer();
            if (musikAktif) {
                const musik = document.getElementById("musikLatar");
                musik.currentTime = 0;
                musik.volume = 0.4;
                musik.play();
            }
            tampilkanCountdown(() => {
                newQuestion();
                mulaiTimer();
            });
            bootstrap.Modal.getInstance(document.getElementById("modalSukses"))?.hide();
            bootstrap.Modal.getInstance(document.getElementById("modalGameOver"))?.hide();
            bootstrap.Modal.getInstance(document.getElementById("pengaturanModal"))?.hide();
        }
        function tampilkanCountdown(callback) {
            const overlay = document.createElement("div");
            overlay.id = "countdownOverlay";
            Object.assign(overlay.style, {
                position: "fixed", top: "0", left: "0", width: "100%", height: "100%",
                backgroundColor: "rgba(0,0,0,0.8)", color: "white", fontSize: "8rem",
                fontWeight: "bold", display: "flex", alignItems: "center", justifyContent: "center",
                zIndex: "9999", flexDirection: "column", fontFamily: "'Arial Black', sans-serif", animation: "fadeIn 0.5s"
            });
            const teks = document.createElement("div");
            teks.id = "countdownText";
            teks.style.transition = "transform 0.3s, color 0.3s";
            overlay.appendChild(teks);
            document.body.appendChild(overlay);
            let count = 3;
            const colors = ["#FF5252", "#FFEB3B", "#4CAF50", "#03A9F4"];
            function animasiCountdown() {
                teks.textContent = count > 0 ? count : "Mulai!";
                teks.style.transform = "scale(1.5)";
                teks.style.color = colors[count] || "#FFFFFF";
                setTimeout(() => { teks.style.transform = "scale(1)"; }, 100);
                if (count < 0) {
                    document.body.removeChild(overlay);
                    callback();
                } else {
                    count--;
                    setTimeout(animasiCountdown, 1000);
                }
            }
            animasiCountdown();
        }
        function mulaiPermainan() {
            updateSkorBenarSalah();
            updateBantuan();
            bootstrap.Modal.getInstance(document.getElementById("modalPembuka"))?.hide();
            updateLivesDisplay();
            tampilkanCountdown(() => {
                newQuestion();
                mulaiTimer();
                if (musikAktif) {
                    const musik = document.getElementById("musikLatar");
                    musik.volume = 0.4;
                    musik.play();
                }
            });
        }
        function playKlikSound() {
            if (soundAktif) {
                const klikSound = document.getElementById("klikSound");
                klikSound.currentTime = 0;
                klikSound.play();
            }
        }
        document.addEventListener("DOMContentLoaded", () => {
            updateSkorBenarSalah();
            updateBantuan();
            new bootstrap.Modal(document.getElementById("modalPembuka")).show();
            document.getElementById("benarSound").volume = 0.8;
            document.getElementById("salahSound").volume = 0.8;
            document.getElementById("klikSound").volume = 0.6;
            document.getElementById("selesaiSound").volume = 1.0;
            document.getElementById("winSound").volume = 1.0;
            document.querySelectorAll("button, a").forEach(el => {
                el.addEventListener("click", playKlikSound);
            });
            const pengaturanModal = document.getElementById("pengaturanModal");
            let waktuSaatPause = 0;
            pengaturanModal.addEventListener("show.bs.modal", () => {
                stopTimer();
                waktuSaatPause = waktuSisa;
            });
            pengaturanModal.addEventListener("hidden.bs.modal", () => {
                if (document.getElementById("dropzone").textContent === "Tarik jawaban ke sini") {
                    lanjutkanTimer(waktuSaatPause);
                }
            });
            function lanjutkanTimer(sisa) {
                waktuSisa = sisa;
                document.getElementById("timer").textContent = `‚è±Ô∏è Waktu: ${waktuSisa} detik`;
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    waktuSisa--;
                    document.getElementById("timer").textContent = `‚è±Ô∏è Waktu: ${waktuSisa} detik`;
                    if (soundAktif) {
                        const tick = document.getElementById("tickSound");
                        tick.currentTime = 0;
                        tick.play();
                    }
                    if (waktuSisa <= 0) {
                        clearInterval(timerInterval);
                        waktuHabis();
                    }
                }, 1000);
            }
        });
        function bukaModalBantuan() {
            if (bantuanTersisa <= 0) {
                document.getElementById("hint").textContent = "‚ùó Bantuan sudah habis (maksimal 3x per game).";
                return;
            }
            // Hilangkan pengecekan bantuanDigunakan
            updateBantuan();
            new bootstrap.Modal(document.getElementById("modalBantuan")).show();
        }

        function bantuanWaktu() {
            if (bantuanTersisa <= 0) return;
            waktuSisa += 10;
            document.getElementById("timer").textContent = `‚è±Ô∏è Waktu: ${waktuSisa} detik`;
            bantuanTersisa--;
            updateBantuan();
            bantuanSelesai("‚åõ Waktu ditambah 10 detik");
        }

        function bantuanHitung() {
            if (bantuanTersisa <= 0) return;
            let hintText = penjelasanCaraHitung(a, b);
            document.getElementById("hint").innerHTML = hintText;
            bantuanTersisa--;
            updateBantuan();
            bantuanSelesai();
        }

        function bantuanSelesai(pesan = "") {
            // Hilangkan set bantuanDigunakan jadi true supaya bisa dipakai lagi
            if (pesan) document.getElementById("hint").textContent = pesan;
            bootstrap.Modal.getInstance(document.getElementById("modalBantuan")).hide();
        }

        // Tombol keluar
        window.addEventListener("popstate", function (e) {
            e.preventDefault();
            new bootstrap.Modal(document.getElementById("modalKeluar")).show();
            history.pushState(null, null, location.href);
        });
        window.addEventListener("load", function () {
            history.pushState(null, null, location.href);
        });
        function konfirmasiKeluar() {
            window.removeEventListener("beforeunload", () => { });
            location.href = "halaman-utama.html";
        }
        document.addEventListener("visibilitychange", function () {
            if (document.hidden) {
                stopTimer();
                if (musikAktif) document.getElementById("musikLatar").pause();
            } else {
                if (document.getElementById("dropzone").textContent === "Tarik jawaban ke sini") {
                    mulaiTimer();
                    if (musikAktif) document.getElementById("musikLatar").play();
                }
            }
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <audio id="benarSound" src="../asset/sound/soundBenar.mp3"></audio>
    <audio id="salahSound" src="../asset/sound/soundSalah.mp3"></audio>
    <audio id="musikLatar" src="../asset/sound/musik-latar2.mp3" loop></audio>
    <audio id="selesaiSound" src="../asset/sound/gameSelesai.wav"></audio>
    <audio id="winSound" src="../asset/sound/sukses.mp3"></audio>
    <audio id="klikSound" src="../asset/sound/mouse-click.wav"></audio>
    <audio id="tickSound" src="../asset/sound/detik.mp3"></audio>
</body>

</html>